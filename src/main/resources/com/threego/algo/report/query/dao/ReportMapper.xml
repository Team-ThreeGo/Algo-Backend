<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.threego.algo.report.query.dao.ReportMapper">
    <!-- 모든 신고 목록 조회 -->
    <select id="selectAllReportDetails" resultType="com.threego.algo.report.query.dto.ReportDetailResponseDTO">
        SELECT
               A.ID
             , A.MEMBER_ID AS MEMBERID
             , D.NICKNAME AS REPORTER
             , C.ID AS CATEGORYID
             , C.NAME AS CATEGORYNAME
             , B.ID AS TYPEID
             , B.TYPE AS TYPENAME
             , A.CONTENT
             , A.TARGET_ID AS TARGETID
             , A.CREATED_AT AS CREATEDAT
             , A.REPORTED_MEMBER_ID AS REPORTEDMEMBERID
             , E.NICKNAME AS REPORTED
          FROM REPORT A
          JOIN REPORT_TYPE B ON A.TYPE_ID = B.ID
          JOIN REPORT_CATEGORY C ON A.CATEGORY_ID = C.ID
          JOIN MEMBER D ON A.MEMBER_ID = D.ID
          JOIN MEMBER E ON A.reported_member_id = E.ID;

    </select>

    <!-- 특정 회원의 모든 신고 목록 조회 -->
    <select id="selectReportDetailsById" resultType="com.threego.algo.report.query.dto.ReportDetailResponseDTO">
        SELECT
               A.ID
             , A.MEMBER_ID AS MEMBERID
             , D.NICKNAME AS REPORTER
             , C.ID AS CATEGORYID
             , C.NAME AS CATEGORYNAME
             , B.ID AS TYPEID
             , B.TYPE AS TYPENAME
             , A.CONTENT
             , A.TARGET_ID AS TARGETID
             , A.CREATED_AT AS CREATEDAT
             , A.REPORTED_MEMBER_ID AS REPORTEDMEMBERID
             , E.NICKNAME AS REPORTED
          FROM REPORT A
          JOIN REPORT_TYPE B ON A.TYPE_ID = B.ID
          JOIN REPORT_CATEGORY C ON A.CATEGORY_ID = C.ID
          JOIN MEMBER D ON A.MEMBER_ID = D.ID
          JOIN MEMBER E ON A.reported_member_id = E.ID
          WHERE A.MEMBER_ID = #{id}
    </select>

    <!-- 특정 회원이 당한 모든 신고 목록 조회 -->
    <select id="selectReportedDetailsById" resultType="com.threego.algo.report.query.dto.ReportDetailResponseDTO">
        SELECT
               A.ID
             , A.MEMBER_ID AS MEMBERID
             , D.NICKNAME AS REPORTER
             , C.ID AS CATEGORYID
             , C.NAME AS CATEGORYNAME
             , B.ID AS TYPEID
             , B.TYPE AS TYPENAME
             , A.CONTENT
             , A.TARGET_ID AS TARGETID
             , A.CREATED_AT AS CREATEDAT
             , A.REPORTED_MEMBER_ID AS REPORTEDMEMBERID
             , E.NICKNAME AS REPORTED
          FROM REPORT A
          JOIN REPORT_TYPE B ON A.TYPE_ID = B.ID
          JOIN REPORT_CATEGORY C ON A.CATEGORY_ID = C.ID
          JOIN MEMBER D ON A.MEMBER_ID = D.ID
          JOIN MEMBER E ON A.reported_member_id = E.ID
         WHERE A.REPORTED_MEMBER_ID = #{id}
    </select>

</mapper>